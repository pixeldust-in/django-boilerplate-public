pool:
  vmImage: ubuntu-latest

steps:
  - task: Docker@2
    inputs:
      containerRegistry: $(REGISTRY_SERVICE_CONNECTION)
      command: "login"
      addPipelineData: false
      addBaseImageData: false
    displayName: Login to ACR

  - task: Docker@2
    inputs:
      containerRegistry: $(REGISTRY_SERVICE_CONNECTION)
      repository: $(REPOSITORY_NAME)
      command: "build"
      Dockerfile: "**/Dockerfile"
      tags: $(TAG_NAME)
      addPipelineData: false
      addBaseImageData: false
    displayName: Build docker image

  - task: Docker@2
    inputs:
      containerRegistry: $(REGISTRY_SERVICE_CONNECTION)
      repository: $(REPOSITORY_NAME)
      command: "push"
      tags: $(TAG_NAME)
      addPipelineData: false
      addBaseImageData: false
    displayName: Pushing Image to ACR

  - task: AzureAppServiceManage@0
    inputs:
      azureSubscription: $(AZ_SERVICE_CONN_ID)
      Action: "Restart Azure App Service"
      WebAppName: $(APP_SERVICE_NAME)
    displayName: "Restart Azure App Service"
